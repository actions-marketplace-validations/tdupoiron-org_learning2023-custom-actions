name: Create Repository on Issue creation via inline scripts

on:
  issues:
    types:
      - opened

permissions:
  issues: write

jobs:

  # 1. Extract repository settings from issue body
  extract_repository_settings:

    if: contains(github.event.issue.labels.*.name, 'repo-ops')

    uses: ./.github/workflows/rwf-extract-repository-settings.yml
    with: 
      issue_body: ${{ github.event.issue.body }}

  # 2. Rename issue
  rename_issue:
    needs: extract_repository_settings

    uses: ./.github/workflows/rwf-rename-issue.yml
    with: 
      issue_number: ${{ github.event.issue.number }}
      repo_owner: ${{ github.event.repository.owner.login }}
      repo_name: ${{ github.event.repository.name }}
      issue_title: "New repository request: ${{ needs.extract_repository_settings.outputs.repository_name }}"
    secrets: inherit
